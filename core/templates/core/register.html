{% extends 'core/base.html' %}
{% load static %}

{% block title %}Registro de Usuario{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'core/css/auth.css' %}">
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card" style="max-width: 500px;"> <div class="auth-header">
            <h2>Crear Cuenta</h2>
            <p style="color: #666; font-size: 0.9rem;">Únete a Felmar y empieza a ganar</p>
        </div>
        {% if messages %}
            <div style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #f5c6cb; font-size: 0.9rem; display: flex; align-items: center; gap: 10px;">
                {% for message in messages %}
                    <i class="fa-solid fa-circle-exclamation"></i> {{ message }}
                {% endfor %}
            </div>
        {% endif %}

        <form method="POST" action="" id="registerForm" novalidate>
            {% csrf_token %}

            {% if form.non_field_errors %}
                <div style="color: red; font-size: 0.9rem; margin-bottom: 15px; text-align: center;">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Nombre</label>
                    <div class="input-group">
                        <i class="fa-solid fa-user input-icon"></i>
                        {{ form.first_name }} </div>
                    {{ form.first_name.errors }} </div>
                <div class="form-group">
                    <label class="form-label">Apellido</label>
                    <div class="input-group">
                        <i class="fa-regular fa-user input-icon"></i>
                        {{ form.last_name }} </div>
                    {{ form.last_name.errors }}
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Cédula (C.I.)</label>
                    <div class="input-group">
                        <i class="fa-solid fa-id-card input-icon"></i>
                        {{ form.ci }} </div>
                    {{ form.ci.errors }}
                </div>
                <div class="form-group">
                    <label class="form-label">Fecha de Nacimiento</label>
                    <div class="input-group">
                        <i class="fa-solid fa-calendar-days input-icon"></i>
                        {{ form.birthdate }} </div>
                    {{ form.birthdate.errors }}
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Correo Electrónico</label>
                <div class="input-group">
                    <i class="fa-solid fa-envelope input-icon"></i>
                    {{ form.email }} </div>
                {{ form.email.errors }}
            </div>

            <div class="form-group">
                <label class="form-label">Nombre de Usuario</label>
                <div class="input-group">
                    <i class="fa-solid fa-at input-icon"></i>
                    {{ form.username }} </div>
                {{ form.username.errors }}
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Contraseña</label>
                    <div class="input-group">
                        <i class="fa-solid fa-lock input-icon"></i>
                        {{ form.password }} </div>
                    {{ form.password.errors }}
                </div>
                <div class="form-group">
                    <label class="form-label">Confirmar</label>
                    <div class="input-group">
                        <i class="fa-solid fa-check-double input-icon"></i>
                        {{ form.confirm_password }} </div>
                    {{ form.confirm_password.errors }}
                </div>
            </div>
            
            <div class="form-group" style="display: flex; align-items: flex-start; gap: 10px; font-size: 0.9rem; margin-top: 10px;">
                <input type="checkbox" id="terms" required style="margin-top: 4px;">
                <label for="terms" style="cursor: pointer; color: #666;">
                    Certifico que soy mayor de edad y acepto las <a href="#" id="linkPrivacy" style="color: var(--primary); text-decoration: underline;">Políticas de Privacidad</a> y Términos de Uso de Lotería Felmar.
                </label>
            </div>

            <button type="submit" class="btn btn-primary btn-block">
                <i class="fa-solid fa-user-plus"></i> Registrarse
            </button>
        </form>

        <div class="auth-links">
            <p>¿Ya tienes cuenta? <a href="{% url 'login' %}">Inicia Sesión</a></p>
        </div>

    </div>
</div>

<div id="privacyModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Políticas de Privacidad y Juego Responsable</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <h4>1. Responsable de los Datos</h4>
            <p>Lotería Felmar C.A., con RIF J-310748314, se compromete a proteger la privacidad de sus usuarios. Los datos recopilados serán utilizados exclusivamente para la gestión de apuestas y pagos.</p>
            
            <h4>2. Datos que Recopilamos</h4>
            <p>Para cumplir con las regulaciones nacionales (CONALOT), recopilamos: Nombre completo, Cédula de Identidad (para verificar mayoría de edad), correo electrónico y datos bancarios para la transferencia de premios.</p>

            <h4>3. Protección al Menor</h4>
            <p><strong>ESTRICTAMENTE PROHIBIDO PARA MENORES DE 18 AÑOS.</strong> Si detectamos que un usuario es menor de edad, su cuenta será bloqueada inmediatamente y los fondos retenidos.</p>

            <h4>4. Uso de la Información</h4>
            <ul>
                <li>Procesar sus jugadas y validar ganadores.</li>
                <li>Realizar pagos de premios a cuentas verificadas.</li>
                <li>Cumplimiento de normativas contra la legitimación de capitales.</li>
            </ul>

            <h4>5. Seguridad</h4>
            <p>Sus datos están encriptados y no serán compartidos con terceros, salvo requerimiento expreso de autoridades competentes.</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancelModalBtn">Cancelar</button>          
            <button type="button" class="btn btn-primary" id="acceptModalBtn">Entendido, Acepto</button>
        </div>
    </div>
</div>

<div id="successModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
        <div class="modal-body" style="padding: 40px 30px;">
            <div class="success-animation">
                <i class="fa-solid fa-circle-check"></i>
            </div>
            
            <h3 style="color: var(--primary); font-size: 1.5rem; margin-bottom: 10px;">¡Bienvenido a Felmar!</h3>
            
            <p style="text-align: center; color: #666; margin-bottom: 25px;">
                Tu cuenta ha sido creada exitosamente. Ya puedes ingresar y empezar a ganar.
            </p>
            
            <a href="{% url 'login' %}" class="btn btn-primary btn-block">
                Iniciar Sesión
            </a>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
    <script src="{% static 'core/js/auth.js' %}"></script>
    {% if success %}
        <div id="registration-success-flag" style="display: none;"></div>
    {% endif %}
{% endblock %}